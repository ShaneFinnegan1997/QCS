<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quad Cities Sweepstakes</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="header-container"></div>

  <main>
    <center>


    <div id="announcement-container" style="margin-top: 10px; padding: 5px; background-color: rgba(255, 255, 255, 0.1); border-radius: 5px; position: relative;">
        <span id="announcement-text">Loading announcement...</span>
        <br>
        <span id="announcement-timestamp" style="font-size: 0.7em; color: #ddd;"></span></div>
             <a href="editannouncement.html" style="position: absolute; bottom: 5px; right: 5px; color: teal; text-decoration: none;">Admin Edit</a>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD-giQ4CGXX6F0RIXbAzbp_0vDDomoLo8g",
            authDomain: "qcsweeps-4b994.firebaseapp.com",
            databaseURL: "https://qcsweeps-4b994-default-rtdb.firebaseio.com",
            projectId: "qcsweeps-4b994",
            storageBucket: "qcsweeps-4b994.appspot.com",
            messagingSenderId: "810241609281",
            appId: "1:810241609281:web:63ecd22b6acbee2cf480c0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Announcement code
        document.addEventListener('DOMContentLoaded', function() {
            const announcementRef = ref(db, 'announcement');
            const announcementTextElement = document.getElementById('announcement-text');
            const announcementTimestampElement = document.getElementById('announcement-timestamp');

            onValue(announcementRef, (snapshot) => {
                const announcement = snapshot.val();
                if (announcement && announcement.text) {
                    announcementTextElement.textContent = announcement.text;
                    announcementTimestampElement.textContent = "Last Updated: " + (new Date(announcement.timestamp)).toLocaleString();
                } else {
                    announcementTextElement.textContent = 'No announcement currently.';
                    announcementTimestampElement.textContent = "";
                }
            });
        });
    </script>
      
      
      <section class="countdown-section">
        <h1>Next Drawing In:</h1>
        <h2 id="countdown">Loading...</h2>
        <a id="entry-btn" class="hidden" href="#" target="_blank">Enter Drawing</a>
      </section>
    </center>
  </main>

  <div id="footer-container"></div>

  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- Firebase Setup + Countdown Logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-giQ4CGXX6F0RIXbAzbp_0vDDomoLo8g",
      authDomain: "qcsweeps-4b994.firebaseapp.com",
      databaseURL: "https://qcsweeps-4b994-default-rtdb.firebaseio.com",
      projectId: "qcsweeps-4b994",
      storageBucket: "qcsweeps-4b994.appspot.com",
      messagingSenderId: "810241609281",
      appId: "1:810241609281:web:63ecd22b6acbee2cf480c0",
      measurementId: "G-XL9VQ985S9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const timerDisplay = document.getElementById("countdown");
    const entryBtn = document.getElementById("entry-btn");

    let countdownInterval = null;

    firebase.database().ref("countdown").on("value", (snapshot) => {
      const data = snapshot.val();
      clearInterval(countdownInterval);

      if (data && data.targetTime) {
        const endTime = new Date(data.targetTime).getTime();

        entryBtn.href = data.entryLink || "#";
        entryBtn.classList.remove("hidden");

        countdownInterval = setInterval(() => {
          const now = Date.now();
          const remaining = endTime - now;

          if (remaining <= 0) {
            timerDisplay.innerText = "Drawing has started!";
            clearInterval(countdownInterval);
            return;
          }

          const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
          const hours = Math.floor((remaining / (1000 * 60 * 60)) % 24);
          const mins = Math.floor((remaining / (1000 * 60)) % 60);
          const secs = Math.floor((remaining / 1000) % 60);

          timerDisplay.innerText = `${days}d ${hours}h ${mins}m ${secs}s`;
        }, 1000);
      } else {
        timerDisplay.innerText = "No drawing currently.";
        entryBtn.classList.add("hidden");
      }
    });
  </script>

  <!-- Load header/footer -->
  <script>
    async function loadHTML(selector, url) {
      try {
        const response = await fetch(url);
        if (response.ok) {
          const html = await response.text();
          document.querySelector(selector).innerHTML = html;
        }
      } catch (e) {
        console.error("Failed to load:", url);
      }
    }
    loadHTML("#header-container", "header.html");
    loadHTML("#footer-container", "footer.html");
  </script>
</body>
</html>
