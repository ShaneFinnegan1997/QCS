// Updated Admin Panel JavaScript Code

// Firebase configuration (already initialized before this) const adminPassword = "qcadmin2024"; let isLoggedIn = localStorage.getItem("adminLoggedIn") === "true";

function showAdminPanel() { document.getElementById("adminLogin").style.display = "none"; document.getElementById("adminPanel").style.display = "block"; loadEvents(); }

function checkLogin() { const password = document.getElementById("adminPassword").value; if (password === adminPassword) { localStorage.setItem("adminLoggedIn", "true"); isLoggedIn = true; showAdminPanel(); } else { alert("Incorrect password"); } }

function logout() { localStorage.removeItem("adminLoggedIn"); isLoggedIn = false; document.getElementById("adminPanel").style.display = "none"; document.getElementById("adminLogin").style.display = "block"; }

window.onload = function () { if (isLoggedIn) { showAdminPanel(); } else { document.getElementById("adminLogin").style.display = "block"; } };

function loadEvents() { eventsList.innerHTML = "Loading..."; firebase.database().ref("events").once("value", (snapshot) => { const data = snapshot.val(); eventsList.innerHTML = "";

if (data) {
  Object.entries(data).reverse().forEach(([key, event]) => {
    const div = document.createElement("div");
    div.className = "event-card";
    div.innerHTML =
      "<strong>Title:</strong> <span id='title-" + key + "' contenteditable='false'>" + event.title + "</span><br>" +
      "<strong>Description:</strong> <span id='description-" + key + "' contenteditable='false'>" + event.description + "</span><br>" +
      "<strong>Link:</strong> <span id='link-" + key + "' contenteditable='false'>" + (event.link || "") + "</span><br>" +
      "<strong>Total Winnings:</strong> <span id='total-winnings-" + key + "' contenteditable='false'>$" + (event.totalWinnings || 0) + "</span><br>" +
      "<strong>Winner Payout:</strong> <span id='winner-payout-amount-" + key + "' contenteditable='false'>$" + (event.winnerPayoutAmount || 0) + "</span><br>" +
      "<strong>Non-Profit:</strong> <span id='non-profit-name-" + key + "' contenteditable='false'>" + (event.nonProfitName || "N/A") + "</span> - " +
      "<span id='non-profit-donation-amount-" + key + "' contenteditable='false'>$" + (event.nonProfitDonationAmount || 0) + "</span><br>" +
      "<strong>Non-Profit Website:</strong> <span id='non-profit-website-link-" + key + "' contenteditable='false'>" + (event.nonProfitWebsiteLink || "") + "</span><br>" +
      "<strong>Website Funds:</strong> <span id='website-funds-amount-" + key + "' contenteditable='false'>$" + (event.websiteFundsAmount || 0) + "</span><br>" +
      "<div class='event-actions'>" +
      "<button onclick=\"enableEdit('" + key + "', this)\">Edit</button>" +
      "<button onclick=\"deleteEvent('" + key + "', this)\">Delete</button>" +
      "</div>";
    eventsList.appendChild(div);
  });
} else {
  eventsList.innerHTML = "<p>No events found.</p>";
}

}); }

function enableEdit(key, btn) { const card = btn.closest(".event-card"); const editing = btn.innerText === "Save";

const titleElement = card.querySelector("#title-" + key); const descriptionElement = card.querySelector("#description-" + key); const linkElement = card.querySelector("#link-" + key); const totalWinningsElement = card.querySelector("#total-winnings-" + key); const winnerPayoutAmountElement = card.querySelector("#winner-payout-amount-" + key); const nonProfitNameElement = card.querySelector("#non-profit-name-" + key); const nonProfitDonationAmountElement = card.querySelector("#non-profit-donation-amount-" + key); const nonProfitWebsiteLinkElement = card.querySelector("#non-profit-website-link-" + key); const websiteFundsAmountElement = card.querySelector("#website-funds-amount-" + key);

if (editing) { const updatedEvent = { title: titleElement.innerText.trim(), description: descriptionElement.innerText.trim(), link: linkElement.innerText.trim(), totalWinnings: totalWinningsElement.innerText.replace(/[^0-9.]/g, "").trim(), winnerPayoutAmount: winnerPayoutAmountElement.innerText.replace(/[^0-9.]/g, "").trim(), nonProfitName: nonProfitNameElement.innerText.trim(), nonProfitDonationAmount: nonProfitDonationAmountElement.innerText.replace(/[^0-9.]/g, "").trim(), nonProfitWebsiteLink: nonProfitWebsiteLinkElement.innerText.trim(), websiteFundsAmount: websiteFundsAmountElement.innerText.replace(/[^0-9.]/g, "").trim() };

firebase.database().ref("events/" + key).update(updatedEvent, (error) => {
  if (error) {
    alert("Error updating event: " + error);
  } else {
    alert("Event updated!");
    btn.innerText = "Edit";
    [
      titleElement, descriptionElement, linkElement, totalWinningsElement,
      winnerPayoutAmountElement, nonProfitNameElement, nonProfitDonationAmountElement,
      nonProfitWebsiteLinkElement, websiteFundsAmountElement
    ].forEach(el => el.contentEditable = false);
  }
});

} else { btn.innerText = "Save"; [ titleElement, descriptionElement, linkElement, totalWinningsElement, winnerPayoutAmountElement, nonProfitNameElement, nonProfitDonationAmountElement, nonProfitWebsiteLinkElement, websiteFundsAmountElement ].forEach(el => el.contentEditable = true);

titleElement.focus();

} }

function deleteEvent(key, btn) { if (confirm("Are you sure you want to delete this event?")) { firebase.database().ref("events/" + key).remove() .then(() => { btn.closest(".event-card").remove(); }) .catch(error => alert("Error deleting event: " + error)); } }

