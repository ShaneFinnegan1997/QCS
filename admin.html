<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QCS Admin</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
    .admin-container { max-width: 800px; /* Increased max-width */ margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .hidden { display: none; }
    input, button, textarea, select { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; } /* Added select and box-sizing */
    img.banner { max-width: 100%; border-radius: 10px; margin-bottom: 20px; }
    .logout-btn { margin-top: 20px; }
    section { margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; } /* Added section styling */
    label { display: block; margin-top: 10px; font-weight: bold; } /* Added label styling */
    #event-list { list-style: none; padding: 0; } /* Style event list */
    #event-list li { margin-bottom: 5px; padding: 8px; background-color: #f9f9f9; border-radius: 4px; } /* Style event list items */
    .event-actions { display: inline-block; margin-left: 10px; } /* Added styling for event actions */

    /* Additional styling for better layout */
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }

  </style>
</head>
<body>

  <div id="header-container"></div>

  <div class="admin-container">
    <img class="banner" src="https://i.imgur.com/yP7hK0j.png" alt="Admin Panel Banner" />

    <div id="login-section">
      <h2>Admin Login</h2>
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <button onclick="login()">Login</button>
    </div>

    <div id="admin-panel" class="hidden">
      <h2>Welcome, Admin</h2>

      <section>
        <h3>Update Countdown Timer</h3>
        <label for="target-time">Target Time:</label>
        <input type="datetime-local" id="target-time" />
        <label for="entry-link">Entry Link (Optional):</label>
        <input type="text" id="entry-link" placeholder="Entry link (optional)" />
        <button onclick="updateCountdown()">Update Countdown</button>
      </section>

      <section>
        <h3>Manage Events</h3>
        <label for="event-title">Event Title:</label>
        <input type="text" id="event-title" placeholder="Event Title" />
        <label for="event-link">Event Link:</label>
        <input type="text" id="event-link" placeholder="Event Link" />
        <label for="event-description">Event Description (optional):</label>
        <textarea id="event-description" placeholder="Event Description (optional)"></textarea>
        <button onclick="addEvent()">Add Event</button>
        <ul id="event-list"></ul>
      </section>

      <section>
        <h3>Manage Users</h3>
        <label for="new-username">New Username:</label>
        <input type="text" id="new-username" placeholder="New Username">
        <label for="new-password">New Password:</label>
        <input type="password" id="new-password" placeholder="New Password">
        <button onclick="addUser()">Add User</button>
        <ul id="user-list"></ul>
      </section>

      <section>
        <h3>Manage Sweepstakes</h3>
        <label for="sweepstakes-title">Sweepstakes Title:</label>
        <input type="text" id="sweepstakes-title" placeholder="Sweepstakes Title">
          <label for="sweepstakes-description">Sweepstakes Description:</label>
          <textarea id="sweepstakes-description" placeholder="Sweepstakes Description"></textarea>
        <label for="sweepstakes-start">Start Date:</label>
        <input type="datetime-local" id="sweepstakes-start" />
        <label for="sweepstakes-end">End Date:</label>
        <input type="datetime-local" id="sweepstakes-end" />
        <label for="sweepstakes-winners">Number of Winners:</label>
        <input type="number" id="sweepstakes-winners" placeholder="Number of Winners">
        <button onclick="addSweepstakes()">Add Sweepstakes</button>
        <ul id="sweepstakes-list"></ul>
      </section>

      <section>
        <h3>Send Announcement</h3>
        <label for="announcement-title">Announcement Title:</label>
        <input type="text" id="announcement-title" placeholder="Announcement Title">
        <label for="announcement-message">Announcement Message:</label>
        <textarea id="announcement-message" placeholder="Announcement Message"></textarea>
        <button onclick="sendAnnouncement()">Send Announcement</button>
      </section>

      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div id="footer-container"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-giQ4CGXX6F0RIXbAzbp_0vDDomoLo8g",
      authDomain: "qcsweeps-4b994.firebaseapp.com",
      databaseURL: "https://qcsweeps-4b994-default-rtdb.firebaseio.com",
      projectId: "qcsweeps-4b994",
      storageBucket: "qcsweeps-4b994.appspot.com",
      messagingSenderId: "810241609281",
      appId: "1:810241609281:web:63ecd22b6acbee2cf480c0",
      measurementId: "G-XL9VQ985S9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Login Function
    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      db.ref("admins/" + username).once("value").then(snapshot => {
        const data = snapshot.val();
        if (data && data.password === password) {
          localStorage.setItem("adminUser", username);
          showAdminPanel();
        } else {
          alert("Invalid username or password");
        }
      });
    }

    function showAdminPanel() {
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("admin-panel").classList.remove("hidden");
      loadEvents();
      loadUsers();
      loadSweepstakes();
    }

    function logout() {
      localStorage.removeItem("adminUser");
      location.reload();
    }

    // Countdown Timer Function
    function updateCountdown() {
      const targetTime = document.getElementById("target-time").value;
      const entryLink = document.getElementById("entry-link").value;

      db.ref("countdown").set({
        targetTime,
        entryLink
      });
      alert("Countdown updated!");
    }

    // Event Management Functions
    function addEvent() {
      const title = document.getElementById("event-title").value;
      const link = document.getElementById("event-link").value;
      const description = document.getElementById("event-description").value; // Get description

      const eventRef = db.ref("events").push();
      eventRef.set({ title, link, description }); // Save description
      document.getElementById("event-title").value = "";
      document.getElementById("event-link").value = "";
      document.getElementById("event-description").value = ""; // Clear description
      loadEvents();
    }

    function deleteEvent(key) {
      db.ref("events/" + key).remove();
      loadEvents();
    }

    function loadEvents() {
      const list = document.getElementById("event-list");
      list.innerHTML = "";
      db.ref("events").once("value").then(snapshot => {
        snapshot.forEach(child => {
          const event = child.val();
          const li = document.createElement("li");
          li.innerHTML = `
            <strong>\${event.title}</strong><br>
            <a href="\${event.link}" target="_blank">Link</a><br>
            ${event.description ? `<p>${event.description}</p>` : ''}
            <div class="event-actions">
              <button onclick="deleteEvent('\${child.key}')">Delete</button>
            </div>
          `;
          list.appendChild(li);
        });
      });
    }

    // User Management Functions
    function addUser() {
      const username = document.getElementById("new-username").value;
      const password = document.getElementById("new-password").value;

      db.ref("admins/" + username).set({
        password: password
      }).then(() => {
        alert("User added successfully!");
        document.getElementById("new-username").value = "";
        document.getElementById("new-password").value = "";
        loadUsers();
      }).catch(error => {
        console.error("Error adding user: ", error);
        alert("Failed to add user.");
      });
    }

    function deleteUser(username) {
      if (confirm("Are you sure you want to delete this user?")) {
        db.ref("admins/" + username).remove().then(() => {
          alert("User deleted successfully!");
          loadUsers();
        }).catch(error => {
          console.error("Error deleting user: ", error);
          alert("Failed to delete user.");
        });
      }
    }

    function loadUsers() {
      const userList = document.getElementById("user-list");
      userList.innerHTML = "";
      db.ref("admins").once("value").then(snapshot => {
        snapshot.forEach(child => {
          const username = child.key;
          const li = document.createElement("li");
          li.textContent = username;
          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Delete";
          deleteBtn.onclick = () => deleteUser(username);
          li.appendChild(deleteBtn);
          userList.appendChild(li);
        });
      });
    }

    // Sweepstakes Management Functions
    function addSweepstakes() {
        const title = document.getElementById("sweepstakes-title").value;
        const description = document.getElementById("sweepstakes-description").value;
        const start = document.getElementById("sweepstakes-start").value;
        const end = document.getElementById("sweepstakes-end").value;
        const winners = document.getElementById("sweepstakes-winners").value;

        const sweepstakesRef = db.ref("sweepstakes").push();
        sweepstakesRef.set({
            title: title,
            description: description,
            start: start,
            end: end,
            winners: winners
        }).then(() => {
            alert("Sweepstakes added successfully!");
            document.getElementById("sweepstakes-title").value = "";
            document.getElementById("sweepstakes-description").value = "";
            document.getElementById("sweepstakes-start").value = "";
            document.getElementById("sweepstakes-end").value = "";
            document.getElementById("sweepstakes-winners").value = "";
            loadSweepstakes();
        }).catch(error => {
            console.error("Error adding sweepstakes: ", error);
            alert("Failed to add sweepstakes.");
        });
    }

    function deleteSweepstakes(key) {
        if (confirm("Are you sure you want to delete this sweepstakes?")) {
            db.ref("sweepstakes/" + key).remove().then(() => {
                alert("Sweepstakes deleted successfully!");
                loadSweepstakes();
            }).catch(error => {
                console.error("Error deleting sweepstakes: ", error);
                alert("Failed to delete sweepstakes.");
            });
        }
    }

    function loadSweepstakes() {
        const sweepstakesList = document.getElementById("sweepstakes-list");
        sweepstakesList.innerHTML = "";
        db.ref("sweepstakes").once("value").then(snapshot => {
            snapshot.forEach(child => {
                const sweepstakes = child.val();
                const li = document.createElement("li");
                li.innerHTML = `
                    <strong>\${sweepstakes.title}</strong><br>
                    <p>\${sweepstakes.description}</p>
                    <p>Start: \${sweepstakes.start}</p>
                    <p>End: \${sweepstakes.end}</p>
                    <p>Winners: \${sweepstakes.winners}</p>
                    <button onclick="deleteSweepstakes('\${child.key}')">Delete</button>
                `;
                sweepstakesList.appendChild(li);
            });
        });
    }

    // Announcement Function
    function sendAnnouncement() {
      const title = document.getElementById("announcement-title").value;
      const message = document.getElementById("announcement-message").value;

      // You'll need to implement the actual sending mechanism.  This is a placeholder.
      alert(`Announcement Sent!\nTitle: ${title}\nMessage: ${message}`);

      document.getElementById("announcement-title").value = "";
      document.getElementById("announcement-message").value = "";
    }

    // Check login on page load
    window.onload = () => {
      const user = localStorage.getItem("adminUser");
      if (user) showAdminPanel();
    };

    // Load header/footer
    async function loadHTML(selector, url) {
      try {
        const res = await fetch(url);
        if (res.ok) {
          const html = await res.text();
          document.querySelector(selector).innerHTML = html;
        }
      } catch (e) {
        console.error("Failed to load:", url);
      }
    }
    loadHTML("#header-container", "header-admin.html");
    loadHTML("#footer-container", "footer.html");
  </script>
</body>
</html>
