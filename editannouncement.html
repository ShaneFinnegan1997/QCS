<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Announcement</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 20px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #333;
        text-align: center;
      }

      label {
        display: block;
        margin-bottom: 8px;
        color: #555;
      }

      input[type="text"],
      input[type="password"],
      textarea {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
      }

      button {
        background-color: #5cb85c;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      button:hover {
        background-color: #4cae4c;
      }

      #admin-login-error {
        color: red;
        margin-top: 10px;
        text-align: center;
      }
    </style>
</head>
<body>
    <div class="container">
        <h2>Admin Login</h2>

        <label for="admin-username">Username:</label>
        <input type="text" id="admin-username" name="admin-username"><br><br>

        <label for="admin-password">Password:</label>
        <input type="password" id="admin-password" name="admin-password"><br><br>

        <button id="admin-login-submit">Login</button>

        <p id="admin-login-error"></p>

        <h2>Edit Announcement</h2>
        <textarea id="admin-announcement-text" rows="4" cols="50"></textarea><br><br>
        <button id="admin-announcement-save">Save Announcement</button>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      get
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD-giQ4CGXX6F0RIXbAzbp_0vDDomoLo8g",
      authDomain: "qcsweeps-4b994.firebaseapp.com",
      databaseURL: "https://qcsweeps-4b994-default-rtdb.firebaseio.com",
      projectId: "qcsweeps-4b994",
      storageBucket: "qcsweeps-4b994.appspot.com",
      messagingSenderId: "810241609281",
      appId: "1:810241609281:web:63ecd22b6acbee2cf480c0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const adminUsernameInput = document.getElementById('admin-username');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminLoginSubmitButton = document.getElementById('admin-login-submit');
    const adminLoginError = document.getElementById('admin-login-error');
    const adminAnnouncementTextarea = document.getElementById('admin-announcement-text');
    const adminAnnouncementSaveButton = document.getElementById('admin-announcement-save');

    // Load the current announcement from Firebase
    function loadAnnouncement() {
      const announcementRef = ref(db, 'announcement');
      get(announcementRef)
        .then((snapshot) => {
          const announcement = snapshot.val();
          adminAnnouncementTextarea.value = announcement || '';
        })
        .catch((error) => {
          console.error("Error loading announcement:", error);
          adminAnnouncementTextarea.value = "Error loading announcement.";
        });
    }

    // Save the updated announcement to Firebase
    function saveAnnouncement(announcement) {
      const announcementRef = ref(db, 'announcement');
      set(announcementRef, announcement)
        .then(() => {
          alert("Announcement updated successfully!");
        })
        .catch((error) => {
          console.error("Error saving announcement:", error);
          alert("Error saving announcement.");
        });
    }

    // Event listener for the login button
    adminLoginSubmitButton.addEventListener('click', async () => {
        const username = adminUsernameInput.value;
        const password = adminPasswordInput.value;

        // Query the 'admin' node in the database for matching credentials
        const snapshot = await get(ref(db, "admin"));
        const adminData = snapshot.val();

        if (adminData && adminData.username === username && adminData.password === password) {
            loadAnnouncement();
        } else {
            adminLoginError.textContent = 'Invalid username or password.';
        }
    });


    // Event listener for the save announcement button
    adminAnnouncementSaveButton.addEventListener('click', () => {
      const announcementText = adminAnnouncementTextarea.value;
      saveAnnouncement(announcementText);
    });
    </script>
</body>
</html>
