<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getDatabase,
    ref,
    push,
    set,
    onValue,
    remove
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD-giQ4CGXX6F0RIXbAzbp_0vDDomoLo8g",
    authDomain: "qcsweeps-4b994.firebaseapp.com",
    databaseURL: "https://qcsweeps-4b994-default-rtdb.firebaseio.com",
    projectId: "qcsweeps-4b994",
    storageBucket: "qcsweeps-4b994.appspot.com",
    messagingSenderId: "810241609281",
    appId: "1:810241609281:web:63ecd22b6acbee2cf480c0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const eventsRef = ref(db, "events");

  function renderEvents(events) {
    const container = document.getElementById("events-list");
    container.innerHTML = "";
    Object.entries(events || {}).forEach(([key, event]) => {
      const div = document.createElement("div");
      div.className = "event";
      div.innerHTML = `
        <strong>${event.title}</strong><br>
        <small>${new Date(event.time).toLocaleString()}</small><br>
        <p>${event.description}</p>
        <button onclick="deleteEvent('${key}')">Delete</button>
      `;
      container.appendChild(div);
    });
  }

  function addEvent() {
    const title = document.getElementById("event-title").value.trim();
    const description = document.getElementById("event-description").value.trim();
    const time = document.getElementById("event-time").value;

    if (!title || !description || !time) return alert("Fill in all fields.");

    const newRef = push(eventsRef);
    set(newRef, {
      title,
      description,
      time
    });

    document.getElementById("event-title").value = "";
    document.getElementById("event-description").value = "";
    document.getElementById("event-time").value = "";
  }

  function deleteEvent(id) {
    remove(ref(db, `events/${id}`));
  }

  onValue(eventsRef, (snapshot) => {
    renderEvents(snapshot.val());
  });

  window.addEventListener("load", () => {
    if (!sessionStorage.getItem("admin")) {
      window.location.href = "/QCS/admin.html";
    }
  });

  window.deleteEvent = deleteEvent;
  window.addEvent = addEvent;
</script>